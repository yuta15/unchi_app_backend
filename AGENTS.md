# Repository Guidelines

## プロジェクト構成とモジュール配置
- 推奨ディレクトリ例: `app/` または `src/` に本体、`tests/` にテスト、`config/` に設定、`static/` に静的資産、開発用の環境変数は `.env`。
- Python バックエンドを前提。モジュールは小さく分割し、入出力・ドメイン・インフラ層を意識して責務を分離します。

## ビルド・テスト・開発コマンド
- 初期化: `python -m venv .venv && source .venv/bin/activate && pip install -U pip && pip install -r requirements.txt`
- 静的解析/整形: `ruff check .` / `ruff format .`（または `black .`）
- テスト: `pytest -q`（カバレッジ: `pytest --cov=app --cov-report=term-missing`）
- 実行例（API サーバの場合）: `uvicorn app.main:app --reload`（構成に合わせてパスを調整）

## コーディングスタイルと命名規約
- インデントは 4 スペース。型ヒント必須。公開 API には Docstring（Google/Numpy いずれか）を付与。
- 命名: 変数/関数は `snake_case`、クラスは `PascalCase`、定数は `UPPER_SNAKE_CASE`。
- ファイル/モジュールは短い `snake_case`。テストは対象と同名で `tests/test_<module>.py`。

## テスト指針
- フレームワーク: `pytest`。フィクスチャは `conftest.py` に集約。
- 目標: ステートレスロジックは ≥80% カバレッジ。重要経路は失敗系・境界値を必ず含める。
- 形式: 単体テスト優先、外部 I/O はモック。パラメトライズでケースを網羅。

## コミットとプルリクエスト
- コミット: 「何を・なぜ」を短く要約。Conventional Commits 推奨（例: `feat:`, `fix:`, `docs:`, `refactor:`, `test:`, `chore:`）。
- PR 要件: 目的/背景、変更点、動作確認手順、関連 Issue、必要ならログ/スクリーンショット。1 PR = 1 目的で小さく。
- マージ条件: テスト緑、`ruff check`/フォーマッタ済、自己レビュー・コメント反映済。

## コードレビュー観点
- 正しさ: 要件を満たすか。境界値・例外・エラーハンドリングは十分か。
- 可読性: 名前付け、関数/クラスの責務と長さ、重複排除、コメント/Docstring の妥当性。
- 設計: 層の依存方向が適切か。拡張・差し替えやすい分割か。
- 安全性: 入力検証、認証/認可、秘密情報の扱い、SQL/OS インジェクション対策、ログに個人情報を出さない。
- 性能: 明らかな N+1、不要な同期 I/O、大きなデータコピーの有無。
- テスト: 重要経路の網羅、失敗系・リグレッション再現、速く安定して再現可能か。
- 運用: ログレベル適切、設定は環境変数駆動、メトリクス/ヘルスチェックの有無。

## セキュリティと設定
- 秘密情報は環境変数またはシークレット管理を使用（`.env` は開発用途のみ）。
- 依存性を定期更新し、必要に応じ `pip-audit` 等で脆弱性を確認。
- CORS、レート制限、タイムアウトは要件に応じて設定。

